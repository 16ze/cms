generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum AdminRole {
  ADMIN
  SUPER_ADMIN
}

model AdminUser {
  id                     String                  @id @default(uuid())
  name                   String?
  email                  String                  @unique
  hashedPassword         String
  role                   AdminRole               @default(ADMIN)
  lastLogin              DateTime?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  permissions            AdminPermission[]
  notifications          Notification[]
  notificationPreference NotificationPreference?
  pushSubscriptions      PushSubscription[]
}

model AdminPermission {
  id        String   @id @default(uuid())
  userId    String
  page      String   // dashboard, reservations, clients, content, site, users, settings
  canView   Boolean  @default(false)
  canEdit   Boolean  @default(false)
  canDelete Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      AdminUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, page])
  @@index([userId])
}

model GoogleOAuthToken {
  id           String   @id @default(uuid())
  accessToken  String
  refreshToken String?
  scope        String
  tokenType    String
  expiryDate   DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([expiryDate])
}

model User {
  id             String         @id @default(uuid())
  name           String
  email          String         @unique
  hashedPassword String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  availabilities Availability[]
  reservations   Reservation[]
}

model Availability {
  id          String    @id @default(uuid())
  userId      String
  dayOfWeek   Int
  startTime   String
  endTime     String
  isRecurring Boolean   @default(true)
  date        DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User      @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([dayOfWeek])
  @@index([date])
}

model Exclusion {
  id          String   @id @default(uuid())
  startDate   DateTime
  endDate     DateTime
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Reservation {
  id                  String            @id @default(uuid())
  userId              String
  clientName          String
  clientEmail         String
  clientPhone         String?
  reservationType     ReservationType
  status              ReservationStatus @default(PENDING)
  startTime           DateTime
  endTime             DateTime
  projectDescription  String?
  communicationMethod String?
  meetingLink         String?
  notes               String?
  reminderSent        Boolean           @default(false)
  cancellationToken   String            @unique @default(cuid())
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  user                User              @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([startTime, endTime])
  @@index([status])
  @@index([clientEmail])
}

model ReservationSettings {
  id                          String   @id @default(uuid())
  minNoticeTime               Int      @default(1)
  maxAdvanceBookingDays       Int      @default(60)
  defaultSessionDuration      Int      @default(60)
  reminderHoursBeforeEvent    Int      @default(24)
  discoverySessionDuration    Int      @default(30)
  consultationSessionDuration Int      @default(60)
  presentationSessionDuration Int      @default(45)
  followupSessionDuration     Int      @default(30)
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt
}

model ContentPage {
  id              String              @id @default(uuid())
  slug            String              @unique
  title           String
  metaTitle       String?
  metaDescription String?
  status          ContentStatus       @default(DRAFT)
  isActive        Boolean             @default(true)
  orderIndex      Int                 @default(0)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  sections        ContentSection[]
  designSettings  DesignPageSettings?

  @@index([slug])
  @@index([status])
  @@index([orderIndex])
}

model ContentSection {
  id           String               @id @default(uuid())
  pageId       String
  sectionName  String
  sectionType  SectionType
  orderIndex   Int                  @default(0)
  contentJson  Json
  isActive     Boolean              @default(true)
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  page         ContentPage          @relation(fields: [pageId], references: [id], onDelete: Cascade)
  versions     ContentVersion[]
  designStyles DesignSectionStyles?

  @@index([pageId])
  @@index([sectionType])
  @@index([orderIndex])
}

model ContentMedia {
  id           String   @id @default(uuid())
  filename     String
  originalName String
  altText      String?
  filePath     String
  mimeType     String
  fileSize     Int
  width        Int?
  height       Int?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([mimeType])
  @@index([isActive])
}

model ContentVersion {
  id                String         @id @default(uuid())
  sectionId         String
  contentJson       Json
  versionNumber     Int
  changeDescription String?
  createdBy         String?
  createdAt         DateTime       @default(now())
  section           ContentSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  @@index([sectionId])
  @@index([versionNumber])
}

model DesignGlobalSettings {
  id         String   @id @default(uuid())
  category   String
  property   String
  value      String
  deviceType String   @default("all")
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([category, property, deviceType])
  @@index([category])
  @@index([deviceType])
}

model DesignSectionStyles {
  id               String         @id @default(uuid())
  contentSectionId String         @unique
  styleConfigJson  Json
  isActive         Boolean        @default(true)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  contentSection   ContentSection @relation(fields: [contentSectionId], references: [id], onDelete: Cascade)

  @@index([contentSectionId])
}

model DesignPageSettings {
  id              String      @id @default(uuid())
  contentPageId   String      @unique
  pageStyleConfig Json
  isActive        Boolean     @default(true)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  contentPage     ContentPage @relation(fields: [contentPageId], references: [id], onDelete: Cascade)

  @@index([contentPageId])
}

model DesignTheme {
  id          String   @id @default(uuid())
  name        String
  description String?
  configJson  Json
  isDefault   Boolean  @default(false)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([name])
  @@index([isDefault])
}

model DesignHistory {
  id         String   @id @default(uuid())
  changeType String
  oldValue   String?
  newValue   String
  userId     String?
  metadata   Json?
  createdAt  DateTime @default(now())

  @@index([changeType])
  @@index([userId])
  @@index([createdAt])
}

model SiteHeader {
  id         String   @id @default(uuid())
  logo       String
  logoUrl    String?
  navigation Json
  buttons    Json
  buttonUrls Json?
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([isActive])
}

model SiteFooter {
  id          String   @id @default(uuid())
  company     String
  description String
  contact     Json
  social      Json
  links       Json?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
}

model SiteTheme {
  id          String   @id @default(uuid())
  name        String   @unique
  displayName String
  isActive    Boolean  @default(true)
  isDefault   Boolean  @default(false)
  configJson  Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([isDefault])
}

model SiteSettings {
  id          String   @id @default(uuid())
  key         String   @unique
  value       String
  description String?
  category    String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([key])
  @@index([category])
}

model ButtonStyles {
  id          String   @id @default(uuid())
  name        String   @unique
  displayName String
  configJson  Json
  isActive    Boolean  @default(true)
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([isDefault])
}

model Client {
  id           String              @id @default(uuid())
  firstName    String
  lastName     String
  email        String              @unique
  phone        String?
  company      String?
  address      String?
  status       ClientStatus        @default(PROSPECT)
  source       ClientSource
  notes        String?
  lastContact  DateTime?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  interactions ClientInteraction[]
  projects     ClientProject[]

  @@index([email])
  @@index([status])
  @@index([source])
  @@index([lastContact])
  @@index([createdAt])
}

model ClientProject {
  id           String              @id @default(uuid())
  clientId     String
  name         String
  description  String?
  status       ProjectStatus       @default(PENDING)
  budget       Int?
  startDate    DateTime?
  endDate      DateTime?
  priority     Int                 @default(1)
  tags         Json?
  notes        String?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  interactions ClientInteraction[]
  client       Client              @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([status])
  @@index([startDate])
  @@index([priority])
}

model ClientInteraction {
  id             String          @id @default(uuid())
  clientId       String
  projectId      String?
  type           InteractionType
  date           DateTime
  description    String
  outcome        String?
  followUpDate   DateTime?
  isFollowUpDone Boolean         @default(false)
  duration       Int?
  createdBy      String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  client         Client          @relation(fields: [clientId], references: [id], onDelete: Cascade)
  project        ClientProject?  @relation(fields: [projectId], references: [id])

  @@index([clientId])
  @@index([projectId])
  @@index([type])
  @@index([date])
  @@index([followUpDate])
  @@index([isFollowUpDone])
}

model ClientDocument {
  id          String   @id @default(uuid())
  clientId    String
  fileName    String
  filePath    String
  fileType    String
  mimeType    String
  fileSize    Int
  description String?
  isActive    Boolean  @default(true)
  uploadedBy  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([clientId])
  @@index([fileType])
  @@index([isActive])
}

model ChatbotKnowledgeBase {
  id              String   @id @default(uuid())
  documentId      String   @unique
  contentChunk    String
  embeddingVector Json?
  metadataJson    Json?
  category        String
  keywords        String
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([category])
  @@index([isActive])
  @@index([keywords])
}

model ChatbotConversation {
  id           String           @id @default(uuid())
  sessionId    String           @unique
  userIp       String?
  userAgent    String?
  startedAt    DateTime         @default(now())
  lastActivity DateTime         @default(now())
  isActive     Boolean          @default(true)
  pageUrl      String?
  userContext  Json?
  messages     ChatbotMessage[]

  @@index([sessionId])
  @@index([isActive])
  @@index([startedAt])
}

model ChatbotMessage {
  id             String              @id @default(uuid())
  conversationId String
  senderType     String
  messageContent String
  contextUsed    Json?
  responseTimeMs Int?
  confidence     Float?
  intent         String?
  userFeedback   String?
  createdAt      DateTime            @default(now())
  conversation   ChatbotConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([senderType])
  @@index([createdAt])
  @@index([intent])
}

model ChatbotAnalytics {
  id               String   @id @default(uuid())
  sessionId        String?
  eventType        String
  eventData        Json?
  userSatisfaction Int?
  resolutionStatus String?
  pageUrl          String?
  createdAt        DateTime @default(now())

  @@index([sessionId])
  @@index([eventType])
  @@index([createdAt])
}

enum ReservationType {
  DISCOVERY
  CONSULTATION
  PRESENTATION
  FOLLOWUP
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum ContentStatus {
  DRAFT
  PENDING
  PUBLISHED
  ARCHIVED
}

enum SectionType {
  HERO
  TEXT
  GRID
  SERVICES
  TESTIMONIALS
  CONTACT
  CUSTOM
}

enum ClientStatus {
  PROSPECT
  CLIENT
  INACTIVE
}

enum ClientSource {
  WEBSITE
  REFERRAL
  SOCIAL
  DIRECT
}

enum ProjectStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum InteractionType {
  EMAIL
  PHONE
  MEETING
  QUOTE
  NOTE
}

// ===== MODÈLES CRM COMPLETS =====

model CrmContact {
  id           String           @id @default(uuid())
  type         CrmContactType   @default(PROSPECT)
  companyName  String?
  firstName    String
  lastName     String
  email        String           @unique
  phone        String?
  mobile       String?
  address      String?
  city         String?
  postalCode   String?
  country      String           @default("France")
  website      String?
  industry     String?
  companySize  CrmCompanySize?
  source       CrmContactSource @default(WEBSITE)
  status       CrmContactStatus @default(NEW)
  assignedTo   String?
  tags         Json?
  notes        String?
  leadScore    Int              @default(0)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  opportunities CrmOpportunity[]
  activities   CrmActivity[]
  tasks        CrmTask[]
  quotes       CrmQuote[]
  emailHistory CrmEmailHistory[]
  activityParticipants CrmActivityParticipant[]

  @@index([email])
  @@index([type])
  @@index([status])
  @@index([assignedTo])
  @@index([source])
  @@index([leadScore])
  @@index([createdAt])
}

model CrmPipelineStage {
  id           String           @id @default(uuid())
  name         String
  orderIndex   Int
  probability  Int              @default(0)
  color        String           @default("#007AFF")
  isActive     Boolean          @default(true)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  opportunities CrmOpportunity[]

  @@index([orderIndex])
  @@index([isActive])
}

model CrmOpportunity {
  id                String           @id @default(uuid())
  contactId         String
  title             String
  description       String?
  value             Float?
  currency          String           @default("EUR")
  stageId           String
  probability       Int              @default(0)
  expectedCloseDate DateTime?
  actualCloseDate   DateTime?
  source            String?
  assignedTo        String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  contact           CrmContact       @relation(fields: [contactId], references: [id], onDelete: Cascade)
  stage             CrmPipelineStage @relation(fields: [stageId], references: [id])
  activities        CrmActivity[]
  tasks             CrmTask[]
  quotes            CrmQuote[]
  items             CrmOpportunityItem[]

  @@index([contactId])
  @@index([stageId])
  @@index([assignedTo])
  @@index([expectedCloseDate])
  @@index([createdAt])
}

model CrmActivity {
  id             String           @id @default(uuid())
  contactId      String
  opportunityId  String?
  type           CrmActivityType
  subject        String
  description    String?
  status         CrmActivityStatus @default(PLANNED)
  priority       CrmPriority      @default(MEDIUM)
  
  // Planification temporelle
  startDatetime  DateTime?
  endDatetime    DateTime?
  durationMinutes Int?            @default(60)
  isAllDay       Boolean          @default(false)
  
  // Localisation et modalité
  location       String?
  meetingType    String?          @default("in_person") // 'in_person', 'video_call', 'phone_call', 'email'
  meetingUrl     String?
  
  // Suivi et résultats
  dueDate        DateTime?
  completedAt    DateTime?
  outcome        String?          // 'successful', 'needs_follow_up', 'no_response', 'rescheduled', 'cancelled'
  outcomeNotes   String?
  nextAction     String?
  
  // Rappels
  reminderEnabled Boolean         @default(true)
  reminderMinutesBefore Int?      @default(15)
  reminderSent   Boolean          @default(false)
  reminderSentAt DateTime?
  
  // Récurrence
  isRecurring    Boolean          @default(false)
  recurrencePattern Json?
  parentActivityId String?
  
  // Métadonnées
  externalCalendarId String?
  assignedTo     String?
  createdBy      String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  
  contact        CrmContact       @relation(fields: [contactId], references: [id], onDelete: Cascade)
  opportunity    CrmOpportunity?  @relation(fields: [opportunityId], references: [id])
  participants   CrmActivityParticipant[]
  attachments    CrmActivityAttachment[]
  reminders      CrmActivityReminder[]
  parentActivity CrmActivity?     @relation("ActivityRecurrence", fields: [parentActivityId], references: [id])
  childActivities CrmActivity[]   @relation("ActivityRecurrence")

  @@index([contactId])
  @@index([opportunityId])
  @@index([type])
  @@index([status])
  @@index([assignedTo])
  @@index([dueDate])
  @@index([startDatetime])
  @@index([endDatetime])
  @@index([createdAt])
  @@index([parentActivityId])
}

model CrmTask {
  id             String           @id @default(uuid())
  title          String
  description    String?
  contactId      String?
  opportunityId  String?
  assignedTo     String
  createdBy      String
  priority       CrmPriority      @default(MEDIUM)
  status         CrmTaskStatus    @default(TODO)
  dueDate        DateTime?
  reminderDateTime DateTime?
  tags           Json?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  contact        CrmContact?      @relation(fields: [contactId], references: [id])
  opportunity    CrmOpportunity?  @relation(fields: [opportunityId], references: [id])

  @@index([contactId])
  @@index([opportunityId])
  @@index([assignedTo])
  @@index([status])
  @@index([dueDate])
  @@index([createdAt])
}

model CrmQuote {
  id             String           @id @default(uuid())
  quoteNumber    String           @unique
  contactId      String
  opportunityId  String?
  title          String
  description    String?
  subtotal       Float?
  taxRate        Float            @default(20.00)
  taxAmount      Float?
  totalAmount    Float?
  validUntil     DateTime?
  status         CrmQuoteStatus   @default(DRAFT)
  termsConditions String?
  createdAt      DateTime         @default(now())
  sentAt         DateTime?
  viewedAt       DateTime?
  acceptedAt     DateTime?
  updatedAt      DateTime         @updatedAt
  contact        CrmContact       @relation(fields: [contactId], references: [id], onDelete: Cascade)
  opportunity    CrmOpportunity?  @relation(fields: [opportunityId], references: [id])
  items          CrmQuoteItem[]

  @@index([contactId])
  @@index([opportunityId])
  @@index([status])
  @@index([quoteNumber])
  @@index([createdAt])
}

model CrmQuoteItem {
  id          String    @id @default(uuid())
  quoteId     String
  serviceName String
  description String?
  quantity    Float     @default(1)
  unitPrice   Float?
  totalPrice  Float?
  orderIndex  Int
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  quote       CrmQuote  @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([quoteId])
  @@index([orderIndex])
}

model CrmEmailCampaign {
  id              String           @id @default(uuid())
  name            String
  subject         String?
  contentHtml     String?
  contentText     String?
  status          CrmCampaignStatus @default(DRAFT)
  scheduledAt     DateTime?
  sentAt          DateTime?
  targetAudience  Json?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  emailHistory    CrmEmailHistory[]

  @@index([status])
  @@index([scheduledAt])
  @@index([createdAt])
}

model CrmEmailHistory {
  id          String           @id @default(uuid())
  contactId   String
  campaignId  String?
  subject     String
  content     String?
  status      CrmEmailStatus   @default(SENT)
  sentAt      DateTime
  openedAt    DateTime?
  clickedAt   DateTime?
  createdAt   DateTime         @default(now())
  contact     CrmContact       @relation(fields: [contactId], references: [id], onDelete: Cascade)
  campaign    CrmEmailCampaign? @relation(fields: [campaignId], references: [id])

  @@index([contactId])
  @@index([campaignId])
  @@index([status])
  @@index([sentAt])
}

model CrmMetrics {
  id           String      @id @default(uuid())
  metricType   String
  periodType   CrmPeriodType
  periodStart  DateTime
  periodEnd    DateTime
  value        Float
  metadata     Json?
  calculatedAt DateTime    @default(now())

  @@index([metricType])
  @@index([periodType])
  @@index([periodStart])
  @@index([calculatedAt])
}

model CrmAutomationRule {
  id           String   @id @default(uuid())
  name         String
  triggerEvent String
  conditions   Json
  actions      Json
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  logs         CrmAutomationLog[]

  @@index([triggerEvent])
  @@index([isActive])
}

model CrmAutomationLog {
  id             String           @id @default(uuid())
  ruleId         String
  contactId      String?
  opportunityId  String?
  triggerData    Json?
  executedActions Json?
  status         CrmAutomationStatus @default(SUCCESS)
  errorMessage   String?
  executedAt     DateTime         @default(now())
  rule           CrmAutomationRule @relation(fields: [ruleId], references: [id], onDelete: Cascade)

  @@index([ruleId])
  @@index([contactId])
  @@index([opportunityId])
  @@index([status])
  @@index([executedAt])
}

model CrmChurnPrediction {
  id                  String   @id @default(uuid())
  contactId           String
  churnProbability   Float
  riskFactors        Json?
  recommendedActions Json?
  calculatedAt       DateTime @default(now())

  @@index([contactId])
  @@index([churnProbability])
  @@index([calculatedAt])
}

// ===== ENUMS CRM =====

enum CrmContactType {
  PROSPECT
  CLIENT
  PARTNER
  SUPPLIER
}

enum CrmCompanySize {
  FREELANCER
  SIZE_1_10
  SIZE_11_50
  SIZE_51_200
  SIZE_200_PLUS
}

enum CrmContactSource {
  WEBSITE
  RECOMMENDATION
  PROSPECTING
  TRADE_SHOW
  SOCIAL_MEDIA
  OTHER
}

enum CrmContactStatus {
  NEW
  QUALIFIED
  IN_PROGRESS
  CLIENT
  LOST
  INACTIVE
}

enum CrmActivityType {
  CALL
  EMAIL
  MEETING
  TASK
  NOTE
  QUOTE
  CONTRACT
}

enum CrmActivityStatus {
  PLANNED
  COMPLETED
  CANCELLED
}

enum CrmPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum CrmTaskStatus {
  TODO
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum CrmQuoteStatus {
  DRAFT
  SENT
  VIEWED
  ACCEPTED
  REJECTED
  EXPIRED
}

enum CrmCampaignStatus {
  DRAFT
  SCHEDULED
  SENT
  PAUSED
}

enum CrmEmailStatus {
  SENT
  DELIVERED
  OPENED
  CLICKED
  BOUNCED
  FAILED
}

enum CrmPeriodType {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum CrmAutomationStatus {
  SUCCESS
  FAILED
  PARTIAL
}

// Produits/Services pour les opportunités
model CrmProduct {
  id          String   @id @default(uuid())
  name        String
  description String?
  unitPrice   Float?
  category    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  opportunityItems CrmOpportunityItem[]

  @@index([category])
  @@index([isActive])
}

// Lignes d'opportunité (produits/services dans l'opportunité)
model CrmOpportunityItem {
  id               String   @id @default(uuid())
  opportunityId    String
  productId        String?
  customProductName String?
  quantity         Float    @default(1)
  unitPrice        Float?
  totalPrice       Float?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  opportunity      CrmOpportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)
  product          CrmProduct?     @relation(fields: [productId], references: [id])

  @@index([opportunityId])
  @@index([productId])
}

// Métriques historiques pour les rapports
model CrmMetricsHistory {
  id           String   @id @default(uuid())
  metricType   String
  periodType   String   // 'daily', 'weekly', 'monthly'
  periodStart  DateTime
  periodEnd    DateTime
  value        Float
  metadata     Json?
  calculatedAt DateTime @default(now())

  @@index([metricType])
  @@index([periodType])
  @@index([periodStart])
  @@index([periodEnd])
}

// Participants aux activités (pour les réunions)
model CrmActivityParticipant {
  id                String   @id @default(uuid())
  activityId        String
  participantType   String   // 'contact', 'user', 'external'
  contactId         String?
  userId            String?
  externalName      String?
  externalEmail     String?
  externalPhone     String?
  attendanceStatus  String   @default("invited") // 'invited', 'accepted', 'declined', 'tentative', 'attended', 'no_show'
  responseDatetime  DateTime?
  notes             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  activity          CrmActivity @relation(fields: [activityId], references: [id], onDelete: Cascade)
  contact           CrmContact? @relation(fields: [contactId], references: [id])

  @@index([activityId])
  @@index([contactId])
  @@index([userId])
}

// Fichiers joints aux activités
model CrmActivityAttachment {
  id              String   @id @default(uuid())
  activityId      String
  filename        String
  originalFilename String
  filePath        String
  fileSize        Int?
  mimeType        String?
  uploadedBy      String?
  uploadedAt      DateTime @default(now())

  activity        CrmActivity @relation(fields: [activityId], references: [id], onDelete: Cascade)

  @@index([activityId])
  @@index([uploadedBy])
}

// Log des rappels envoyés
model CrmActivityReminder {
  id              String   @id @default(uuid())
  activityId      String
  recipientType   String   // 'assigned_user', 'participant', 'contact'
  recipientId     String
  reminderType    String   // 'email', 'sms', 'push_notification', 'in_app'
  sentAt          DateTime @default(now())
  deliveryStatus  String   @default("sent") // 'sent', 'delivered', 'failed', 'opened'

  activity        CrmActivity @relation(fields: [activityId], references: [id], onDelete: Cascade)

  @@index([activityId])
  @@index([sentAt])
  @@index([deliveryStatus])
}

// Métriques pré-calculées pour performance
model CrmMetricsDaily {
  id              String   @id @default(uuid())
  metricDate      DateTime
  metricType      String   // 'revenue', 'opportunities', 'conversion', 'activities'
  metricValue     Float?
  additionalData  Json?
  calculatedAt    DateTime @default(now())

  @@index([metricDate, metricType])
  @@index([metricType])
}

// Snapshots de performance pour tendances
model CrmPerformanceSnapshot {
  id                  String   @id @default(uuid())
  snapshotDate        DateTime
  userId              String?
  totalOpportunities  Int      @default(0)
  totalValue          Float    @default(0)
  wonOpportunities    Int      @default(0)
  wonValue            Float    @default(0)
  lostOpportunities   Int      @default(0)
  conversionRate      Float    @default(0)
  avgDealSize         Float    @default(0)
  activitiesCompleted Int      @default(0)
  callsMade           Int      @default(0)
  meetingsHeld        Int      @default(0)
  emailsSent          Int      @default(0)
  newContacts         Int      @default(0)
  createdAt           DateTime @default(now())

  @@index([snapshotDate])
  @@index([userId])
}

// Configuration des rapports personnalisés
model CrmCustomReport {
  id                    String   @id @default(uuid())
  name                  String
  description           String?
  reportType            String   // 'table', 'chart', 'dashboard'
  dataSource            String   // 'contacts', 'opportunities', 'activities', 'performance'
  filters               Json?
  chartConfig           Json?
  columnsConfig         Json?
  createdBy             String?
  isPublic              Boolean  @default(false)
  scheduledFrequency    String?  // 'none', 'daily', 'weekly', 'monthly'
  scheduledRecipients   Json?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  exports               CrmReportExport[]

  @@index([createdBy])
  @@index([reportType])
  @@index([isPublic])
}

// Historique des exports de rapports
model CrmReportExport {
  id                String   @id @default(uuid())
  reportId          String?
  exportType        String   // 'pdf', 'excel', 'csv'
  filePath          String?
  fileSize          Int?
  exportedBy        String?
  exportParameters  Json?
  exportedAt        DateTime @default(now())

  report            CrmCustomReport? @relation(fields: [reportId], references: [id])

  @@index([reportId])
  @@index([exportedBy])
  @@index([exportedAt])
}

// ===== SYSTÈME DE NOTIFICATIONS =====

model Notification {
  id          String             @id @default(uuid())
  userId      String
  type        NotificationType
  category    NotificationCategory
  title       String
  message     String
  priority    NotificationPriority @default(MEDIUM)
  read        Boolean            @default(false)
  actionUrl   String?
  actionLabel String?
  metadata    Json?
  expiresAt   DateTime?
  createdAt   DateTime           @default(now())
  readAt      DateTime?
  user        AdminUser          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, read])
  @@index([category])
  @@index([priority])
  @@index([createdAt])
  @@index([expiresAt])
}

model NotificationPreference {
  id               String   @id @default(uuid())
  userId           String   @unique
  emailEnabled     Boolean  @default(true)
  pushEnabled      Boolean  @default(true)
  soundEnabled     Boolean  @default(true)
  reservations     Boolean  @default(true)
  clients          Boolean  @default(true)
  seo              Boolean  @default(true)
  system           Boolean  @default(true)
  content          Boolean  @default(true)
  security         Boolean  @default(true)
  quietHoursEnabled Boolean @default(false)
  quietHoursStart  String?  // Format: "22:00"
  quietHoursEnd    String?  // Format: "08:00"
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  user             AdminUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model NotificationHistory {
  id               String   @id @default(uuid())
  notificationId   String
  userId           String
  action           String   // 'sent', 'delivered', 'read', 'clicked', 'dismissed'
  metadata         Json?
  createdAt        DateTime @default(now())

  @@index([notificationId])
  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

model PushSubscription {
  id           String   @id @default(uuid())
  userId       String
  endpoint     String   @unique
  p256dh       String
  auth         String
  userAgent    String?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  lastUsed     DateTime @default(now())
  user         AdminUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isActive])
}

// ===== ENUMS POUR NOTIFICATIONS =====

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
}

enum NotificationCategory {
  RESERVATION
  CLIENT
  SEO
  SYSTEM
  CONTENT
  SECURITY
  USER
}

enum NotificationPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

// ===== SYSTÈME DE TEMPLATES =====

model Template {
  id          String   @id @default(uuid())
  name        String   @unique
  displayName String
  description String?
  category    TemplateCategory
  thumbnail   String?
  configJson  Json
  isActive    Boolean  @default(true)
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  pages            TemplatePage[]
  sidebarConfigs   TemplateSidebarConfig[]
  customizations   TemplateCustomization[]
  siteTemplates    SiteTemplate[]
  
  @@index([category])
  @@index([isActive])
}

model TemplatePage {
  id          String   @id @default(uuid())
  templateId  String
  slug        String
  title       String
  description String?
  component   String
  orderIndex  Int
  isRequired  Boolean  @default(false)
  configJson  Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  template    Template @relation(fields: [templateId], references: [id], onDelete: Cascade)
  
  @@unique([templateId, slug])
  @@index([templateId])
}

model TemplateSidebarConfig {
  id          String   @id @default(uuid())
  templateId  String
  elementId   String
  label       String
  icon        String
  href        String
  orderIndex  Int
  isRequired  Boolean  @default(false)
  category    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  template    Template @relation(fields: [templateId], references: [id], onDelete: Cascade)
  
  @@unique([templateId, elementId])
  @@index([templateId])
  @@index([orderIndex])
}

model SiteTemplate {
  id          String   @id @default(uuid())
  siteId      String   @default("main") @unique
  templateId  String
  isActive    Boolean  @default(true)
  activatedAt DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  template    Template @relation(fields: [templateId], references: [id])
  
  @@index([templateId])
}

model TemplateCustomization {
  id          String   @id @default(uuid())
  templateId  String
  siteId      String   @default("main")
  colors      Json?
  typography  Json?
  logo        String?
  favicon     String?
  content     Json?
  settings    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  template    Template @relation(fields: [templateId], references: [id], onDelete: Cascade)
  
  @@unique([templateId, siteId])
  @@index([templateId])
}

enum TemplateCategory {
  CORPORATE
  ECOMMERCE
  PORTFOLIO
  BLOG
  RESTAURANT
  WELLNESS      // Bien-être & Fitness
  BEAUTY        // Beauté & Esthétique
  CONSULTATION  // Consultation & Thérapie
  SERVICES      // Prestations Professionnelles
}

// ===== GESTION DES PROJETS =====

model Project {
  id          String   @id @default(uuid())
  title       String
  slug        String   @unique
  description String
  content     String? 
  category    String?
  client      String?
  technologies String?  // JSON array of tech tags
  imageUrl    String?
  images      String?  // JSON array of image URLs
  projectUrl  String?
  status      CorporateProjectStatus @default(COMPLETED)
  startDate   DateTime?
  endDate     DateTime?
  featured    Boolean  @default(false)
  orderIndex  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([status])
  @@index([featured])
  @@index([orderIndex])
  @@index([createdAt])
}

enum CorporateProjectStatus {
  IN_PROGRESS
  COMPLETED
  ARCHIVED
}

// ===== GESTION DE L'ÉQUIPE =====

model TeamMember {
  id          String   @id @default(uuid())
  firstName   String
  lastName    String
  slug        String   @unique
  position    String
  department  String?
  bio         String? 
  photoUrl    String?
  email       String?
  phone       String?
  linkedin    String?
  twitter     String?
  github      String?
  website     String?
  skills      String?  // JSON array of skills
  isActive    Boolean  @default(true)
  orderIndex  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([isActive])
  @@index([orderIndex])
  @@index([department])
}

// ===== E-COMMERCE TEMPLATE =====

model Product {
  id            String   @id @default(uuid())
  name          String
  slug          String   @unique
  description   String  
  shortDesc     String?
  price         Float
  comparePrice  Float?
  cost          Float?
  sku           String?  @unique
  barcode       String?
  trackQuantity Boolean  @default(true)
  quantity      Int      @default(0)
  lowStockAlert Int?
  category      String?
  brand         String?
  tags          String?  // JSON array
  images        String?  // JSON array of image URLs
  featured      Boolean  @default(false)
  isActive      Boolean  @default(true)
  weight        Float?
  dimensions    String?  // JSON {length, width, height}
  seoTitle      String?
  seoDesc       String?
  orderIndex    Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  orderItems    OrderItem[]
  
  @@index([slug])
  @@index([category])
  @@index([brand])
  @@index([isActive])
  @@index([featured])
  @@index([price])
}

model Order {
  id              String      @id @default(uuid())
  orderNumber     String      @unique
  customerName    String
  customerEmail   String
  customerPhone   String?
  customerAddress String?     // JSON
  status          OrderStatus @default(PENDING)
  paymentStatus   PaymentStatus @default(PENDING)
  paymentMethod   String?
  subtotal        Float
  tax             Float       @default(0)
  shipping        Float       @default(0)
  discount        Float       @default(0)
  total           Float
  notes           String?    
  trackingNumber  String?
  shippedAt       DateTime?
  deliveredAt     DateTime?
  cancelledAt     DateTime?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  items           OrderItem[]
  
  @@index([orderNumber])
  @@index([status])
  @@index([paymentStatus])
  @@index([customerEmail])
  @@index([createdAt])
}

model OrderItem {
  id          String   @id @default(uuid())
  orderId     String
  productId   String
  productName String
  quantity    Int
  price       Float
  total       Float
  createdAt   DateTime @default(now())
  
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product     Product  @relation(fields: [productId], references: [id])
  
  @@index([orderId])
  @@index([productId])
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

// ===== BLOG TEMPLATE =====

model Article {
  id            String        @id @default(uuid())
  title         String
  slug          String        @unique
  excerpt       String?      
  content       String       
  coverImage    String?
  authorId      String
  categoryId    String?
  tags          String?       // JSON array
  status        ArticleStatus @default(DRAFT)
  featured      Boolean       @default(false)
  viewCount     Int           @default(0)
  publishedAt   DateTime?
  seoTitle      String?
  seoDesc       String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  author        Author        @relation(fields: [authorId], references: [id])
  category      ArticleCategory? @relation(fields: [categoryId], references: [id])
  
  @@index([slug])
  @@index([authorId])
  @@index([categoryId])
  @@index([status])
  @@index([featured])
  @@index([publishedAt])
}

model ArticleCategory {
  id          String   @id @default(uuid())
  name        String   @unique
  slug        String   @unique
  description String? 
  color       String?
  icon        String?
  orderIndex  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  articles    Article[]
  
  @@index([slug])
  @@index([orderIndex])
}

model Author {
  id          String   @id @default(uuid())
  firstName   String
  lastName    String
  slug        String   @unique
  bio         String? 
  photoUrl    String?
  email       String?
  website     String?
  twitter     String?
  linkedin    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  articles    Article[]
  
  @@index([slug])
  @@index([isActive])
}

enum ArticleStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

// ===== RESTAURANT TEMPLATE =====

model MenuItem {
  id          String      @id @default(uuid())
  name        String
  slug        String      @unique
  description String?    
  category    MenuCategory
  price       Float
  imageUrl    String?
  ingredients String?     // JSON array
  allergens   String?     // JSON array
  dietary     String?     // JSON array (vegetarian, vegan, etc.)
  spicyLevel  Int?        // 0-5
  isAvailable Boolean     @default(true)
  isFeatured  Boolean     @default(false)
  orderIndex  Int         @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  @@index([slug])
  @@index([category])
  @@index([isAvailable])
  @@index([isFeatured])
}

model RestaurantReservation {
  id            String               @id @default(uuid())
  customerName  String
  customerEmail String
  customerPhone String
  date          DateTime
  time          String
  guests        Int
  tableId       String?
  status        RestaurantReservationStatus    @default(PENDING)
  notes         String?             
  confirmedAt   DateTime?
  cancelledAt   DateTime?
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt
  
  table         RestaurantTable?     @relation(fields: [tableId], references: [id])
  
  @@index([date])
  @@index([status])
  @@index([customerEmail])
}

model RestaurantTable {
  id           String                  @id @default(uuid())
  number       String                  @unique
  capacity     Int
  location     TableLocation
  isAvailable  Boolean                 @default(true)
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt
  
  reservations RestaurantReservation[]
  
  @@index([isAvailable])
  @@index([location])
}

enum MenuCategory {
  APPETIZER
  MAIN_COURSE
  DESSERT
  BEVERAGE
  WINE
  SPECIAL
}

enum TableLocation {
  TERRACE
  INDOOR
  BAR
  PRIVATE_ROOM
}

enum RestaurantReservationStatus {
  PENDING
  CONFIRMED
  SEATED
  COMPLETED
  CANCELLED
  NO_SHOW
}

// ===== WELLNESS (BIEN-ÊTRE) TEMPLATE =====

model WellnessCourse {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String? 
  category    String
  duration    Int      // minutes
  capacity    Int
  price       Float
  imageUrl    String?
  coachId     String
  schedule    String?  // JSON {days, times}
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  coach       WellnessCoach @relation(fields: [coachId], references: [id])
  bookings    WellnessBooking[]
  
  @@index([slug])
  @@index([category])
  @@index([coachId])
  @@index([isActive])
}

model WellnessCoach {
  id            String          @id @default(uuid())
  firstName     String
  lastName      String
  slug          String          @unique
  specialty     String
  bio           String?        
  photoUrl      String?
  certifications String?        // JSON array
  email         String?
  phone         String?
  isActive      Boolean         @default(true)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  
  courses       WellnessCourse[]
  bookings      WellnessBooking[]
  
  @@index([slug])
  @@index([isActive])
}

model WellnessBooking {
  id            String   @id @default(uuid())
  courseId      String
  coachId       String
  customerName  String
  customerEmail String
  customerPhone String
  date          DateTime
  time          String
  status        BookingStatus @default(PENDING)
  notes         String? 
  confirmedAt   DateTime?
  cancelledAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  course        WellnessCourse @relation(fields: [courseId], references: [id])
  coach         WellnessCoach  @relation(fields: [coachId], references: [id])
  
  @@index([courseId])
  @@index([coachId])
  @@index([date])
  @@index([status])
  @@index([customerEmail])
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
}

// ===== BEAUTY (BEAUTÉ) TEMPLATE =====

model BeautyTreatment {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String? 
  category    String
  duration    Int      // minutes
  price       Float
  imageUrl    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  appointments BeautyAppointment[]
  
  @@index([slug])
  @@index([category])
  @@index([isActive])
}

model BeautyAppointment {
  id            String   @id @default(uuid())
  treatmentId   String
  customerName  String
  customerEmail String
  customerPhone String
  date          DateTime
  time          String
  status        AppointmentStatus @default(PENDING)
  notes         String? 
  confirmedAt   DateTime?
  cancelledAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  treatment     BeautyTreatment @relation(fields: [treatmentId], references: [id])
  
  @@index([treatmentId])
  @@index([date])
  @@index([status])
  @@index([customerEmail])
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

// ===== CONSULTATION TEMPLATE =====

model Patient {
  id            String   @id @default(uuid())
  firstName     String
  lastName      String
  email         String   @unique
  phone         String
  dateOfBirth   DateTime?
  address       String?  // JSON
  notes         String? 
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  appointments  ConsultationAppointment[]
  
  @@index([email])
  @@index([isActive])
}

model Therapist {
  id            String   @id @default(uuid())
  firstName     String
  lastName      String
  slug          String   @unique
  specialty     String
  bio           String? 
  photoUrl      String?
  qualifications String? // JSON array
  email         String?
  phone         String?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  appointments  ConsultationAppointment[]
  
  @@index([slug])
  @@index([isActive])
}

model ConsultationAppointment {
  id            String   @id @default(uuid())
  patientId     String
  therapistId   String
  date          DateTime
  time          String
  duration      Int      // minutes
  type          String   // initial, follow-up, etc.
  status        ConsultationStatus @default(SCHEDULED)
  notes         String? 
  diagnosis     String? 
  prescription  String? 
  confirmedAt   DateTime?
  completedAt   DateTime?
  cancelledAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  patient       Patient   @relation(fields: [patientId], references: [id])
  therapist     Therapist @relation(fields: [therapistId], references: [id])
  
  @@index([patientId])
  @@index([therapistId])
  @@index([date])
  @@index([status])
}

enum ConsultationStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
  RESCHEDULED
}

// ===== SERVICES (PRESTATIONS PRO) TEMPLATE =====

model ServiceClient {
  id            String   @id @default(uuid())
  companyName   String
  contactName   String
  email         String   @unique
  phone         String?
  address       String?  // JSON
  website       String?
  notes         String? 
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  projects      ServiceProject[]
  quotes        Quote[]
  invoices      Invoice[]
  
  @@index([email])
  @@index([isActive])
}

model ServiceProject {
  id          String        @id @default(uuid())
  name        String
  slug        String        @unique
  description String?      
  clientId    String
  status      ProjectServiceStatus @default(IN_PROGRESS)
  startDate   DateTime?
  endDate     DateTime?
  budget      Float?
  spent       Float         @default(0)
  progress    Int           @default(0) // 0-100
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  
  client      ServiceClient @relation(fields: [clientId], references: [id])
  
  @@index([slug])
  @@index([clientId])
  @@index([status])
}

model Quote {
  id          String      @id @default(uuid())
  quoteNumber String      @unique
  clientId    String
  title       String
  description String?    
  items       String      // JSON array
  subtotal    Float
  tax         Float       @default(0)
  total       Float
  status      QuoteStatus @default(DRAFT)
  validUntil  DateTime?
  acceptedAt  DateTime?
  rejectedAt  DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  client      ServiceClient @relation(fields: [clientId], references: [id])
  
  @@index([quoteNumber])
  @@index([clientId])
  @@index([status])
}

model Invoice {
  id            String        @id @default(uuid())
  invoiceNumber String        @unique
  clientId      String
  title         String
  description   String?      
  items         String        // JSON array
  subtotal      Float
  tax           Float         @default(0)
  total         Float
  status        InvoiceStatus @default(DRAFT)
  dueDate       DateTime?
  paidAt        DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  client        ServiceClient @relation(fields: [clientId], references: [id])
  
  @@index([invoiceNumber])
  @@index([clientId])
  @@index([status])
  @@index([dueDate])
}

enum ProjectServiceStatus {
  PENDING
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum QuoteStatus {
  DRAFT
  SENT
  ACCEPTED
  REJECTED
  EXPIRED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
}

// ===== PORTFOLIO TEMPLATE =====

model GalleryItem {
  id          String   @id @default(uuid())
  title       String
  slug        String   @unique
  description String? 
  imageUrl    String
  category    String?
  tags        String?  // JSON array
  featured    Boolean  @default(false)
  orderIndex  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([slug])
  @@index([category])
  @@index([featured])
  @@index([orderIndex])
}
